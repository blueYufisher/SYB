<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.gdut.llc.mybatis.mapper.self.SelfProjectMapper">
    <resultMap id="BaseResultMap" type="cn.edu.gdut.llc.mybatis.model.Project">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Dec 07 22:32:07 CST 2017.
        -->
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="field" jdbcType="VARCHAR" property="field"/>
        <result column="proj_name" jdbcType="VARCHAR" property="projName"/>
        <result column="proj_type" jdbcType="VARCHAR" property="projType"/>
        <result column="proj_head" jdbcType="VARCHAR" property="projHead"/>
        <result column="phone" jdbcType="VARCHAR" property="phone"/>
        <result column="enter_time" jdbcType="TIMESTAMP" property="enterTime"/>
        <result column="protocol" jdbcType="VARCHAR" property="protocol"/>
        <result column="company_name" jdbcType="VARCHAR" property="companyName"/>
        <result column="register_time" jdbcType="TIMESTAMP" property="registerTime"/>
        <result column="register_money" jdbcType="VARCHAR" property="registerMoney"/>
        <result column="register_field" jdbcType="VARCHAR" property="registerField"/>
        <result column="oper_time" jdbcType="INTEGER" property="operTime"/>
        <result column="status" jdbcType="INTEGER" property="status"/>
        <result column="logo" jdbcType="INTEGER" property="logo"/>
        <result column="proj_url" jdbcType="VARCHAR" property="projUrl"/>
        <result column="visit" jdbcType="INTEGER" property="visit"/>
        <result column="update_time" jdbcType="TIMESTAMP" property="updateTime"/>
        <result column="note" jdbcType="VARCHAR" property="note"/>
    </resultMap>

    <resultMap id="ProjectAndPictureResultMap" type="cn.edu.gdut.llc.mybatis.model.self.SelfProject">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Dec 07 22:32:07 CST 2017.
        -->
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="field" jdbcType="VARCHAR" property="field"/>
        <result column="proj_name" jdbcType="VARCHAR" property="projName"/>
        <result column="proj_type" jdbcType="VARCHAR" property="projType"/>
        <result column="proj_head" jdbcType="VARCHAR" property="projHead"/>
        <result column="phone" jdbcType="VARCHAR" property="phone"/>
        <result column="enter_time" jdbcType="TIMESTAMP" property="enterTime"/>
        <result column="company_name" jdbcType="VARCHAR" property="companyName"/>
        <result column="status" jdbcType="INTEGER" property="status"/>
        <result column="note" jdbcType="VARCHAR" property="note"/>
        <result column="visit" jdbcType="INTEGER" property="visit"/>
        <!--<result column="logo" jdbcType="INTEGER" property="logo"/>-->
        <result column="proj_url" jdbcType="VARCHAR" property="projUrl"/>
        <result column="update_time" jdbcType="TIMESTAMP" property="updateTime"/>
        <collection property="picList" javaType="java.util.List" ofType="cn.edu.gdut.llc.mybatis.model.Pictures">
			<id column="pic_id" jdbcType="INTEGER" property="picId" />
            <result column="pic_url" jdbcType="VARCHAR" property="picUrl" />
        </collection>
    </resultMap>

    <select id="findProjectByNum" resultMap="ProjectAndPictureResultMap" parameterType="Integer">
    SELECT  project.id,proj_name,enter_time,project.proj_url,project.visit,pictures.pic_url
    FROM project
    LEFT JOIN pictures
    ON project.`logo` = pictures.`pic_id`
    ORDER BY enter_time  DESC LIMIT #{num}

</select>

    <select id="findProjectNumByVisit" resultMap="ProjectAndPictureResultMap" parameterType="Integer">
    SELECT  *, pictures.pic_url FROM project
    LEFT JOIN pictures
    ON project.`logo` = pictures.`pic_id`
    ORDER BY visit  DESC LIMIT #{num}

</select>

    <!--<select id="findLimitProject" resultMap="BaseResultMap" parameterType="cn.edu.gdut.llc.share.mesaage.SMParam">-->
    <!--SELECT * FROM project ORDER BY enter_time  DESC LIMIT #{startNum},#{pageSize}-->

    <!--</select>    -->

    <select id="findLimitProject" resultMap="ProjectAndPictureResultMap"
            parameterType="cn.edu.gdut.llc.share.mesaage.SMParam">
    SELECT project.id,FIELD,proj_name,proj_type,proj_head,phone,enter_time,company_name,status,project.update_time,project.note,project.proj_url,project.visit,pictures.pic_url
    FROM project
    LEFT JOIN pictures
    ON project.`logo` = pictures.`pic_id`
    ORDER BY enter_time  DESC LIMIT #{startNum},#{pageSize}

</select>

    <insert id="insertProjectReturnID" parameterType="cn.edu.gdut.llc.mybatis.model.Project">
        insert into project (id, field, proj_name,
        proj_type, proj_head, phone,
        enter_time, protocol, company_name,
        register_time, register_money, register_field,
        oper_time, status, logo,
        proj_url, visit, update_time,
        note, content)
        values (#{id,jdbcType=INTEGER}, #{field,jdbcType=VARCHAR}, #{projName,jdbcType=VARCHAR},
        #{projType,jdbcType=VARCHAR}, #{projHead,jdbcType=VARCHAR}, #{phone,jdbcType=VARCHAR},
        #{enterTime,jdbcType=TIMESTAMP}, #{protocol,jdbcType=VARCHAR}, #{companyName,jdbcType=VARCHAR},
        #{registerTime,jdbcType=TIMESTAMP}, #{registerMoney,jdbcType=VARCHAR}, #{registerField,jdbcType=VARCHAR},
        #{operTime,jdbcType=INTEGER}, #{status,jdbcType=INTEGER}, #{logo,jdbcType=INTEGER},
        #{proj_url,jdbcType=VARCHAR}, #{visit,jdbcType=INTEGER}, #{updateTime,jdbcType=TIMESTAMP},
        #{note,jdbcType=VARCHAR}, #{content,jdbcType=LONGVARCHAR})
        <selectKey keyProperty="id" order="AFTER" resultType="Integer">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <select id="findNextProjectById" resultMap="BaseResultMap" parameterType="cn.edu.gdut.llc.share.mesaage.SMParam">
        <![CDATA[SELECT * FROM project WHERE id = (SELECT id FROM project WHERE id  >  #{paramObj.id} ORDER BY id ASC  LIMIT 1) ]]>
        <!--SELECT * FROM infos WHERE id = (SELECT id FROM infos WHERE id &gt; #{paramObj.type} AND type=#{paramObj.type} ORDER BY id ASC  LIMIT 1)-->
    </select>

    <select id="findPreProjectById" resultMap="BaseResultMap" parameterType="cn.edu.gdut.llc.share.mesaage.SMParam">
        <![CDATA[SELECT * FROM project WHERE id = (SELECT id FROM project WHERE id < #{paramObj.id} ORDER BY id DESC  LIMIT 1)]]>
        <!--SELECT * FROM infos WHERE id = (SELECT id FROM infos WHERE id &lt; #{paramObj.type} AND type=#{paramObj.type} ORDER BY id DESC  LIMIT 1)-->
    </select>

    <select id="searchProjectByProjNameOrCompanyName" resultMap="BaseResultMap"
            parameterType="cn.edu.gdut.llc.share.mesaage.SMParam">
        SELECT * FROM project WHERE
        <if test="paramObj!=null">
            <if test="paramObj.projName!=null and paramObj.projName!=''">
                (proj_name LIKE "%${paramObj.projName}%"
            </if>
            <if test="paramObj.companyName!=null and paramObj.companyName!=''">
                OR company_name LIKE "%${paramObj.companyName}%")
            </if>
        </if>
        ORDER BY enter_time DESC LIMIT #{startNum},#{pageSize}

    </select>

    <select id="conutProjectByProjNameOrCompanyName" resultType="int"
            parameterType="cn.edu.gdut.llc.share.mesaage.SMParam">
        SELECT COUNT(*) FROM project WHERE
        <if test="paramObj!=null">
            <if test="paramObj.projName!=null and paramObj.projName!=''">
                (proj_name LIKE "%${paramObj.projName}%"
            </if>
            <if test="paramObj.companyName!=null and paramObj.companyName!=''">
                OR company_name LIKE "%${paramObj.companyName}%")
            </if>
        </if>
        ORDER BY enter_time DESC LIMIT #{startNum},#{pageSize}

    </select>

</mapper>